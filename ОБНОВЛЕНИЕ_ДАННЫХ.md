# Обновление данных в мини-приложении

## Проблема
Данные в мини-приложении не обновляются автоматически при изменении в боте.

## Решение

### 1. Автоматическое копирование файлов
При сохранении данных в админ-панели файлы автоматически копируются в `webapp/data/`.

### 2. Обновление кэша в мини-приложении
Мини-приложение теперь:
- Проверяет версию данных (`updated_at` или `version`) при каждой загрузке
- Обновляет данные только если версия изменилась
- Принудительно обновляет данные:
  - При возврате в главное меню
  - При фокусе на окне (каждые 30 секунд)
  - При изменении видимости страницы
  - Каждые 2 минуты в фоновом режиме

### 3. Обход кэша браузера
Все запросы к JSON файлам используют:
- `cache: 'no-store'` - запрет кэширования
- `Cache-Control: no-cache, no-store, must-revalidate` заголовки
- Случайные параметры в URL для обхода кэша

## Что делать после изменения данных в боте

### Вариант 1: Автоматически (рекомендуется)
1. Измените данные в админ-панели бота
2. Файлы автоматически скопируются в `webapp/data/`
3. Загрузите обновленную папку `webapp` на Vercel
4. Мини-приложение обновит данные автоматически

### Вариант 2: Вручную
1. Запустите скрипт копирования:
   ```powershell
   cd webapp
   powershell -ExecutionPolicy Bypass -File copy_data_files.ps1
   ```
2. Загрузите обновленную папку `webapp` на Vercel

### Вариант 3: Только для акций
Если изменили только акции:
```powershell
Copy-Item "data\medical\promotions.json" -Destination "webapp\data\medical\" -Force
```

## Проверка обновления
1. Откройте мини-приложение
2. Перейдите в раздел "Акции"
3. Данные должны обновиться автоматически
4. Если не обновились - обновите страницу (Ctrl+F5)

## Отладка
Откройте консоль браузера (F12) и проверьте сообщения:
- "Акции обновлены, версия: ..." - данные обновились
- "Обновление данных..." - идет процесс обновления

